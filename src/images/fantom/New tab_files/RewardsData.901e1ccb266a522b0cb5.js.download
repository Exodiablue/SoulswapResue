(window.webpackJsonp=window.webpackJsonp||[]).push([["RewardsData"],{"6ADy":function(e,t,r){"use strict";r.d(t,"b",(function(){return d})),r.d(t,"c",(function(){return l})),r.d(t,"a",(function(){return g}));var i=r("rvYQ"),n=r("I6Lx"),s=r("kN1G"),a=r("tMmC");let o,c;function d(){const e=Object(i.b)();if(!o){!function(e){o=new URL("",e),h(o)}(Object(s.j)()&&Object(s.k)()?e.EnterpriseServiceUrlBase:e.ServiceUrlBase)}return o}function u(){const e=Object(i.b)();if(!c){!function(e){c=new URL("",e),h(c)}(Object(s.j)()&&Object(s.k)()?e.EnterpriseServiceUrlBase:e.FeedServiceUrlBase)}return c}function l(e,t=d()){return new URL(e+(null==t?void 0:t.search),t)}function g(e,t=u()){return new URL(e+(null==t?void 0:t.search),t)}function h(e){let t=!1;"dev"!==e.searchParams.get("env.service")&&Object(n.a)().UserIsSignedIn&&(t=!0),a.a.log("u-si: "+Object(i.b)().UserId),a.a.log("a-si: "+t),a.a.log("ss-si: "+Object(n.a)().UserIsSignedIn)}},KETb:function(e,t,r){"use strict";r.d(t,"a",(function(){return P})),r.d(t,"b",(function(){return T}));var i=r("D57K"),n=r("XlyT"),s=r("IhCV"),a=r("z2Ro"),o=r("vq4Z"),c=r("VcDS");class d extends a.a{constructor(e,t,r,i){super(e,r,c.a.BeginActivity,s.a.newGuid(),new Date,t),this.LogLevel=o.a.Activity,this.Ended=!1,this.correlationVector=i}}var u=r("KSHU"),l=r("mRXR");class g extends a.a{constructor(e,t,r,i,n,a,d,u){super(e,u,c.a.BeginNetworkActivity,s.a.newGuid(),new Date,d),this.serviceName=t,this.LogLevel=o.a.Activity,this.Ended=!1,this.requestUri=r,this.requestHttpMethod=i,this.currentOperationName=n,this.correlationVector=a}}var h=r("9RHM");class f extends u.a{constructor(e,t){super(e),this.correlationVectorProvider=t}static getInstance(e,t){var r=e||"Default",i=f.InstancesMap[r];if(i)return i;var n=new l.a(r,o.a.Activity);return i=new f(n,t),f.InstancesMap[r]=i,i}isActivityEnabled(){return this.logger.isEnabledFor(o.a.Activity)}createActivity(e,t,r){if(this.isActivityEnabled()){let i,n;t&&(i=t.ActivityId,n=this.getVectorForNewActivity(t,!1));let s=new d(e,i,r,n);return this.logger.log(o.a.Activity,s),s}return t||null}createActivityCallback(e,t,r){return this.isActivityEnabled()?this.createActivity(e(),t,r):t||null}endActivity(e){if(this.isActivityEnabled()&&e&&!e.Ended){e.Ended=!0;const t=new Date,r=Object(h.a)(e);r.LogType=c.a.EndActivity,r.LogDateTime=t;const i=r.LogDateTime.getTime()-e.LogDateTime.getTime();r.Message=r.Message+" ElapsedTime (Milliseconds):"+i.toString(),r.elapsedTimeInMs=i,this.logger.log(o.a.Activity,r)}}createNetworkActivity(e,t,r,i,n,s,a,o){if(this.isActivityEnabled()){s||a||console.warn("'correlationVector' or 'parentActivity' is required to create network activity");let c=s||this.getVectorForNewActivity(a,!0),d=a?a.ActivityId:"";return new g(e,t,r,i,n,c,d,o)}return null}endSuccessfulNetworkActivity(e,t,r){this.endNetworkActivity(e,!0,t,r)}endFailedNetworkActivity(e,t,r,i){this.endNetworkActivity(e,!1,t,r,i)}endNetworkActivity(e,t,r,i,n){if(e&&!e.Ended){e.Ended=!0;let s=new Date,a=Object(h.a)(e);a.LogType=c.a.EndNetworkActivity,a.LogDateTime=s,a.elapsedTimeInMs=a.LogDateTime.getTime()-e.LogDateTime.getTime(),a.successful=t,a.responseSize=r,a.responseStatusCode=i,a.errorMessage=n,this.logger.log(o.a.Activity,a)}}getVectorForNewActivity(e,t){return e&&this.correlationVectorProvider?(e.latestChildCorrelationVector?e.latestChildCorrelationVector=this.correlationVectorProvider.incrementExternalVector(e.latestChildCorrelationVector):(e.latestChildCorrelationVector=this.correlationVectorProvider.extendExternalVector(e.correlationVector),t&&(e.latestChildCorrelationVector=this.correlationVectorProvider.incrementExternalVector(e.latestChildCorrelationVector))),e.latestChildCorrelationVector):""}}f.InstancesMap={};var v=r("/wq8");class m{constructor(e){if(this.loggingService=e,!e)throw"loggingService is required for LoggedExceptionManager."}error(e){throw this.loggingService.error(e),e}fatal(e){throw this.loggingService.fatal(e),e}}var p=r("HDSB");class y{constructor(e,t,r,i,n,s,a){if(!e)throw new Error("loggingService is required for ExponentialBackoffRetry.");const o=new m(e);this.logInvalidParams(o,t,r,i,n,a),this.loggingService=e,this.maxRetries=t||y.defaultMaxRetries,this.baseRetryDelayInMs=r||y.defaultBaseRetryDelayInMs,this.maxRetryDelayInMs=i||y.maxAllowedRetryDelayInMs,this.factor=n||y.defaultFactor,this.minOffsetInMs=s||y.defaultMinOffsetInMs,this.maxOffsetInMs=a||y.defaultMaxOffsetInMs,Object(p.a)()&&this.loggingService.infoCallback(()=>"ExponentialBackoffRetry has been configured.",null,{maxRetries:t,minTimeout:r,maxTimeout:i,factor:n})}executeRequest(e,t,r){return Object(i.a)(this,void 0,void 0,(function*(){return new Promise((n,s)=>Object(i.a)(this,void 0,void 0,(function*(){yield this.tryRequest(e,n,s,0,t,r)})))}))}logInvalidParams(e,t,r,i,n,s){t&&(t<1||t>y.maxAllowedRetries)&&e.fatal(`maxRetries should be at least 1 and less than ${y.maxAllowedRetries}.`),r&&r<y.defaultBaseRetryDelayInMs&&e.fatal("baseRetryDelay has to be a positive value greater than or equal to 100."),r&&s&&r<=s&&e.fatal("baseRetryDelay must not be smaller than the maximum delay offset."),i&&(i<=0||i>y.maxAllowedRetryDelayInMs)&&e.fatal(`maxRetryDelay has to be a positive value less than ${y.maxAllowedRetryDelayInMs}.`),n&&n<=0&&e.fatal("factor has to be a positive value.")}tryRequest(e,t,r,n,s,a){return Object(i.a)(this,void 0,void 0,(function*(){try{const r=1e4,i=yield this.timeoutServiceRequest(r,e());t(i)}catch(i){if(Object(p.a)()&&n<this.maxRetries){const o=3,c=parseFloat((Math.random()*(this.minOffsetInMs-this.maxOffsetInMs)+this.maxOffsetInMs).toFixed(o)),d=.5,u=Math.random()<d?-1:1,l=Math.min(this.baseRetryDelayInMs*Math.pow(this.factor,n),this.maxRetryDelayInMs)+c*u;this.loggingService.warnCallback(()=>`Retrying the request in ${l} milliseconds.`,a,{error:i,currentRetry:n+1,requestInfo:s}),setTimeout(()=>this.tryRequest(e,t,r,n+1,s,a),l)}else this.loggingService.errorCallback(()=>Object(p.a)()&&n<this.maxRetries?"ExponentialBackoffRetry has exceeded maximum retries "+this.maxRetries:"Request has failed.",a,{error:i,currentRetry:n,requestInfo:s}),r(i)}}))}timeoutServiceRequest(e,t){return Object(i.a)(this,void 0,void 0,(function*(){return new Promise((r,n)=>Object(i.a)(this,void 0,void 0,(function*(){const i=setTimeout(()=>n(new Error("Service Request Timed out!")),e);try{const e=yield t;r(e),clearTimeout(i)}catch(e){n(e),clearTimeout(i)}})))}))}}y.defaultBaseRetryDelayInMs=100,y.defaultFactor=2,y.defaultMaxOffsetInMs=25,y.defaultMaxRetries=5,y.defaultMinOffsetInMs=1,y.maxAllowedRetries=10,y.maxAllowedRetryDelayInMs=2e3;var b,O=r("VOUN"),w=r("hqLi");class I extends a.a{constructor(e,t,r,i,n){super(e,r,c.a.Instrumentation,i,n),this._counterName=e,this.CounterValue=t}get CounterName(){return this._counterName}incrementValue(){if("number"!=typeof this.CounterValue)throw"ERROR: Counter value is never initialized, cannot perform increment action.";this.CounterValue++}}class R extends u.a{constructor(e){super(e)}static getInstance(e){const t=e||"Default";let r=R.InstancesMap[t];if(r)return r;let i=new l.a(t,o.a.Trace);return r=new R(i),R.InstancesMap[t]=r,r}static getDimensionedLogItems(e,t){let r=[],i=new I(e.CounterName,e.CounterValue,Object(h.a)(e.Data),e.ActivityId,e.LogDateTime);if(i.LogLevel=o.a.Trace,r.push(i),t&&!Object(w.a)(t))for(let i of Object.keys(t))for(let n of t[i]){let t=i.indexOf(":")>-1?`${e.CounterName}(${i.replace(":","-")}: ${n})`:`${e.CounterName}(${i}: ${n})`,s=new I(t,e.CounterValue,Object(h.a)(e.Data),e.ActivityId,e.LogDateTime);s.LogLevel=o.a.Trace,r.push(s)}return r}logPerfCounter(e,t,r,i){const n=new I(e,t,i);this.logPerfCounterItem(n,r)}logPerfCounterItem(e,t){const r=R.getDimensionedLogItems(e,t);for(let e of r)this.logger.log(o.a.Trace,e)}}R.InstancesMap={};class A extends a.a{constructor(e,t,r,i,n,s,a,c){super(e,a),this.pageName=e,this.LogLevel=o.a.Activity,this._userActivityType=t,this.correlationVector=r,this.trackingData=i,this.pageTitle=n,this.pageUri=s,this.eventData=c}get userActivityType(){return this._userActivityType}}!function(e){e[e.None=0]="None",e[e.PageAction=1]="PageAction",e[e.PageView=2]="PageView"}(b||(b={}));class j extends u.a{constructor(e){super(e)}static getInstance(e){var t=e||"Default",r=j.InstancesMap[t];if(r)return r;var i=new l.a(t,o.a.Activity);return r=new j(i),j.InstancesMap[t]=r,r}isActivityTrackingEnabled(){return this.logger.isEnabledFor(o.a.Activity)}logPageView(e,t,r,i,n,s){this.isActivityTrackingEnabled()&&this.logger.log(o.a.Activity,this.getUserActivityLogItem(e,t,r,n,s,i))}logPageActionEvent(e,t,r,i,n,s,a){if(this.isActivityTrackingEnabled()){if(!e)throw"''eventData' required for logging page action event.";e.elementTitle&&e.eventType&&e.elementTitle.trim()&&e.eventType.trim()&&this.logger.log(o.a.Activity,this.getUserActivityLogItem(t,r,i,s,a,n,e))}}getUserActivityLogItem(e,t,r,i,n,s,a){if(!e)throw"''pageName' is required for logging user activity.";return a?new A(e,b.PageAction,t,r,i,n,s,a):new A(e,b.PageView,t,r,i,n,s)}}j.InstancesMap={};class S{constructor(e,t,r,i){this.loggingServiceInstance=e||O.a.getInstance(),this.activityServiceInstance=t||f.getInstance(),this.userActivityServiceInstance=r||j.getInstance(),this.perfCounterServiceInstance=i||R.getInstance()}get loggingService(){return this.loggingServiceInstance}get activityLoggingService(){return this.activityServiceInstance}get userActivityTrackingService(){return this.userActivityServiceInstance}get perfCounterLoggingService(){return this.perfCounterServiceInstance}getLoggingServiceByName(e){return this.checkLoggerName(e),O.a.getInstance(e)}getActivityLoggingServiceByName(e){return this.checkLoggerName(e),f.getInstance(e)}getUserActivityTrackingServiceByName(e){return this.checkLoggerName(e),j.getInstance(e)}getPerfCounterLoggingServiceByName(e){return this.checkLoggerName(e),R.getInstance(e)}addActivityLoggingService(e){this.checkServiceInstance(e),f.getInstance(e.getLoggerName())}checkLoggerName(e){if(!e)throw"'loggerName' is required."}checkServiceInstance(e){if(!e)throw"'serviceInstance' is required."}}var C=r("msIb"),M=r("tMmC");let k,E;function P(e,t,r){return Object(i.a)(this,void 0,void 0,(function*(){let i,s;try{if(i=yield fetch(e,t),i&&i.ok)return i}catch(t){Object(n.c)(t,r,"Exception calling 1S primary Url: "+e)}return i&&i.headers&&i.headers.get("OneWebServiceLatency")?i:e.indexOf("assets.msn.com/service/")>0?(s=e.replace("assets.msn.com/service/","api.msn.com/"),yield fetch(s,t)):i}))}function T(e,t){return Object(i.a)(this,void 0,void 0,(function*(){const r=U().activityLoggingService.createActivity(t);return yield C.a.serviceRequestOnComplete(()=>function(){if(E)return E;return E=new y(U().loggingService,3),E}().executeRequest(e,null,r),()=>U().activityLoggingService.endActivity(r))}))}function U(){if(k)return k;const e=f.getInstance("ExperienceActivityLogger");return Object(p.a)()&&M.a.isDebug()&&e.addAppender(new v.a(o.a.Activity)),k=new S(M.a.getLoggingService(),e),k}},Vhls:function(e,t,r){"use strict";r.r(t),r.d(t,"RewardsDataActions",(function(){return n})),r.d(t,"RewardsDataConnector",(function(){return U})),r.d(t,"RewardsDataReducer",(function(){return D})),r.d(t,"mockConfig",(function(){return L.mockConfig})),r.d(t,"ToolingInfo",(function(){return N}));var i=r("G82u");class n{}n.setIsRewardsUser=new i.a("SetIsRewardsUser"),n.setRewardPoints=new i.a("SetRewardPoints"),n.setUnclaimedRewardPoints=new i.a("SetUnclaimedRewardPoints");var s,a,o,c=r("c9mP"),d=r("D57K");!function(e){e.PersonalizeFeed="130",e.TryInformationalMode="131"}(s||(s={})),function(e){e.TopicDataActions="TopicDataActions",e.LayoutActions="LayoutActions"}(a||(a={})),function(e){e.PersonalizeFeed="PersonalizeFeed",e.TryInformationalMode="TryInformationalMode"}(o||(o={}));const u=new Map;u.set(s.PersonalizeFeed,!1),u.set(s.TryInformationalMode,!1);const l=new Map,g={activities:[{experienceConnector:a.TopicDataActions,actionName:o.PersonalizeFeed,requiredCount:1,observedActivityCount:0}],isRewardActivityComplete:!1,isOfferReported:!1},h={activities:[{experienceConnector:a.LayoutActions,actionName:o.TryInformationalMode,requiredCount:1,observedActivityCount:0}],isRewardActivityComplete:!1,isOfferReported:!1};l.set(s.PersonalizeFeed,[g]),l.set(s.TryInformationalMode,[h]);var f=r("tERu"),v=r("s9+9"),m=r("eoyk"),p=r("4k19"),y=r("1w6q"),b=r("rcIs"),O=r("ljWX"),w=r("HxRh"),I=r("tMmC"),R=r("GqIT"),A=r("u5KZ");var j=r("rvYQ"),S=r("msIb"),C=r("6ADy"),M=r("KETb");class k{constructor(e,t=!1){this.fetchImpl=e,this.endpointV2=t,this.fetchRewardsProfileServiceEndpoint="./News/Users/me/Rewards",this.reportRewardsActivityServiceEndpoint="./News/Users/me/RewardsActivities",this.ocid="Peregrine"}getRewardsUserProfile(e){return Object(d.a)(this,void 0,void 0,(function*(){if(e!==f.c.SignedIn&&!this.endpointV2)return null;const t={method:"GET",credentials:"include",cache:"no-cache",headers:yield S.a.getOneServiceHeaders()},r=Object(C.c)(this.fetchRewardsProfileServiceEndpoint);[...S.a.getOneServiceParamsWithAuth(Object(j.b)().UserId,this.ocid)].forEach(e=>{e.value&&r.searchParams.set(e.key,e.value)}),this.endpointV2&&r.searchParams.set("version","2");try{return yield Object(M.b)(()=>Object(d.a)(this,void 0,void 0,(function*(){const e=yield this.fetchImpl(r.href,t);return 404===e.status?{}:e.ok?e.json():(400===e.status?A.a.sendAppErrorEvent(Object.assign(Object.assign({},w.oh.InvalidParameters),{message:"Bad request on account of invalid parameters",pb:Object.assign(Object.assign({},w.oh.InvalidParameters.pb),{customMessage:`Error code: ${e.status} Error message: ${e.statusText}\n                                        Request params: ${t} Service url: ${r.href}`})})):500===e.status?A.a.sendAppErrorEvent(Object.assign(Object.assign({},w.oh.ErrorFetchingUserProfile),{message:"Error fetching user profile",pb:Object.assign(Object.assign({},w.oh.ErrorFetchingUserProfile.pb),{customMessage:`Error code: ${e.status} Error message: ${e.statusText}\n                                        Request params: ${t} Service url: ${r.href}`})})):A.a.sendAppErrorEvent(Object.assign(Object.assign({},w.oh.UnknownErrorOccurred),{message:"Unknown error occurred while fetching user profile",pb:Object.assign(Object.assign({},w.oh.UnknownErrorOccurred.pb),{customMessage:`Error code: ${e.status} Error message: ${e.statusText}\n                                        Request params: ${t} Service url: ${r.href}`})})),null)})),"getUserProfileResponse")}catch(e){return A.a.sendAppErrorEvent(Object.assign(Object.assign({},w.oh.ExceptionFetchingUserProfile),{message:"Exception during user profile service call",pb:Object.assign(Object.assign({},w.oh.ExceptionFetchingUserProfile.pb),{customMessage:`Error code: ${e?e.code:"undefined"} Error message: ${e?e.message:"undefined"}\n                        Request params: ${t} Service url: ${r.href}`})})),null}}))}reportMsRewardsActivity(e,t,r,i){return Object(d.a)(this,void 0,void 0,(function*(){if(e!==f.c.SignedIn)return null;const n=Object(j.b)(),s={method:"POST",body:JSON.stringify({activityId:n.ActivityId,eventType:t,dateTime:(new Date).toISOString(),market:n.CurrentMarket,offerId:r,pageType:n.TrackInfo&&n.TrackInfo.sitePage&&n.TrackInfo.sitePage.page_type,product:n.TrackInfo&&n.TrackInfo.sitePage&&n.TrackInfo.sitePage.page_product,eventContext:i}),headers:yield S.a.getOneServiceHeaders(),credentials:"include"},a=Object(C.c)(this.reportRewardsActivityServiceEndpoint);[...S.a.getOneServiceParamsWithAuth(n.UserId,this.ocid)].forEach(e=>{e.value&&a.searchParams.set(e.key,e.value)});try{return!!(yield Object(M.b)(()=>Object(d.a)(this,void 0,void 0,(function*(){const e=yield this.fetchImpl(a.href,s);return e.ok?e.json():(400===e.status?A.a.sendAppErrorEvent(Object.assign(Object.assign({},w.oh.BadRequestReportingRewardActivity),{message:"Bad request when reporting rewards",pb:Object.assign(Object.assign({},w.oh.BadRequestReportingRewardActivity.pb),{customMessage:`Error code: ${e.status} Error message: ${e.statusText}\n                                        Request params: ${s} Service url: ${a.href}`})})):500===e.status?A.a.sendAppErrorEvent(Object.assign(Object.assign({},w.oh.UnknownErrorsReportingRewardActivity),{message:"Unknown errors when reporting rewards",pb:Object.assign(Object.assign({},w.oh.UnknownErrorsReportingRewardActivity.pb),{customMessage:`Error code: ${e.status} Error message: ${e.statusText}\n                                        Request params: ${s} Service url: ${a.href}`})})):A.a.sendAppErrorEvent(Object.assign(Object.assign({},w.oh.UnknownErrorOccurred),{message:"Unknown errors occurred when reporting rewards",pb:Object.assign(Object.assign({},w.oh.UnknownErrorOccurred.pb),{customMessage:`Error code: ${e.status} Error message: ${e.statusText}\n                                        Request params: ${s} Service url: ${a.href}`})})),!1)})),"reportMsRewardsActivity"))}catch(e){return A.a.sendAppErrorEvent(Object.assign(Object.assign({},w.oh.ExceptionReportingRewardActivity),{message:"Exception reporting reward activity",pb:Object.assign(Object.assign({},w.oh.ExceptionReportingRewardActivity.pb),{customMessage:`Error code: ${e?e.code:"undefined"} Error message: ${e?e.message:"undefined"}\n                        Request params: ${s} Service url: ${a.href}`})})),!1}}))}}var E=r("FaCY"),P=r("r6MD"),T=r("/+Un");class U extends y.a{constructor(e,t,r,i,n,s,a){super(e,t,r,i,n,s,a),this.signInStatus=f.c.Unknown,this.offerPlacedOnUserScreen=void 0,this.activityTrackerMap=void 0,this.bingRewardsOfferStatusMap=void 0,this.rewardsServiceClient=new k(window.fetch.bind(window),s.endpointV2),this.offerMap=new Map,this.offerPlacedOnUserScreen=u,this.activityTrackerMap=l,this.bingRewardsOfferStatusMap=new Map,s.enableRewardsOffers&&Object(T.f)().then(e=>{this.signInStatus=e,(e===f.c.SignedIn||this.config.endpointV2)&&this.getUserProfile().then(()=>Object(d.a)(this,void 0,void 0,(function*(){this.getCurrentState().isRewardsUser&&(this.registerObservers(),yield this.getRewardsOfferMap(),this.syncActivityTrackerMapWithIrisOffers(),yield this.getCoachmarkDataConnector(),yield this.getChromiumPageSettingsConnector(),this.renderOfferMessage())})))})}getUserProfile(){return Object(d.a)(this,void 0,void 0,(function*(){const e=yield this.rewardsServiceClient.getRewardsUserProfile(this.signInStatus);if(!e)return;const t=Object(P.a)(e,"profile.points",void 0);n.setIsRewardsUser.getActionSender(this).send(!!t),t&&n.setRewardPoints.getActionSender(this).send(t);const r=Object(P.a)(e,"offers",void 0);r&&r.forEach(e=>{this.config.endpointV2?this.bingRewardsOfferStatusMap.set(e.activityType,"True"===e.isComplete):this.bingRewardsOfferStatusMap.set(e.offerId,"True"===e.is_complete)})}))}registerObservers(){E.a.updateTopicFollowedState.registerObserver(e=>{this.trackRewardActions(s.PersonalizeFeed,e.params[1])}),m.a.updateLayout.registerObserver(e=>{const t=e&&e.params;!t||t.length<1||t[0].currentLayout===p.i.informational&&this.trackRewardActions(s.TryInformationalMode,"SwitchPageLayout")})}trackRewardActions(e,t){return Object(d.a)(this,void 0,void 0,(function*(){if(!e)return void A.a.sendAppErrorEvent(Object.assign(Object.assign({},w.oh.OfferIdNotDefined),{message:"OfferId is not defined"}));if(!t)return void A.a.sendAppErrorEvent(Object.assign(Object.assign({},w.oh.ActionNameNotDefined),{message:"Action name is not defined"}));const r=this.activityTrackerMap.get(e);!r||this.bingRewardsOfferStatusMap.has(e)&&this.bingRewardsOfferStatusMap.get(e)||r.forEach(r=>Object(d.a)(this,void 0,void 0,(function*(){if(!r.isRewardActivityComplete){let e=!0;r.activities.forEach(t=>{let r=!1;++t.observedActivityCount>=t.requiredCount&&(r=!0),e=e&&r}),r.isRewardActivityComplete=e}!r.isOfferReported&&r.isRewardActivityComplete&&(r.isOfferReported=yield this.rewardsServiceClient.reportMsRewardsActivity(this.signInStatus,t,e),this.renderFollowOnMessage(r,e))})))}))}renderFollowOnMessage(e,t){return Object(d.a)(this,void 0,void 0,(function*(){if(e.isOfferReported){let e=!0,r=0;const i=5;let n=this.config.delayGetUserProfileCallInMs?this.config.delayGetUserProfileCallInMs:500;for(;e&&r<i;r++)yield this.delay(n),this.getUserProfile().then(()=>{if(this.bingRewardsOfferStatusMap.get(t)){e=!1;const r=this.offerMap.has(t)&&this.offerMap.get(t),i=r&&r.length>1&&r[1];i&&this.coachmarkDataConnector.addCoachmark([i])}}),n*=2;e&&A.a.sendAppErrorEvent(Object.assign(Object.assign({},w.oh.MaxRetryReachedForUpdatingRewardsPoints),{message:"Max retry attempt reached to update rewards points on user screen",pb:Object.assign(Object.assign({},w.oh.MaxRetryReachedForUpdatingRewardsPoints.pb),{customMessage:`Attempted ${r} times but user's reward points were not updated for Offer Id : ${t}`})}))}}))}getRewardsOfferMap(){return Object(d.a)(this,void 0,void 0,(function*(){const e=yield class{static getRewardsFromDataConnector(){return Object(d.a)(this,void 0,void 0,(function*(){const e=yield R.a.getInstance().rootReducer.getDataConnector(v.a.IrisData);if(!e)return A.a.sendAppErrorEvent(Object.assign(Object.assign({},w.oh.IrisDataConnectorUndefined),{message:"No Iris data connector"})),null;const t=yield e.getPayload(O.d.MSNNewsCoachmark);return this.extractRewardsCreativeMessages(t)}))}static extractRewardsCreativeMessages(e){if(!e)return I.a.log("IrisHandler: Iris surface not found for the campaign: "+e),null;const t=new Map;let r;return e.creatives.forEach(i=>{const n=[];i.content&&i.content.cm&&i.content.rewards&&i.telemetry&&(i.content.cm.forEach(t=>{r=Object.assign(Object.assign({},t),{coachmarkSource:b.e.Iris,creativeId:i.creativeId,ctaList:t.cta,ecsFeatureFlags:i.content.ecsFeatureFlags,eventUrl:i.telemetry,frequency:Number(i.content.frequency),frequencyInterval:Number(i.content.frequencyInterval),isEcsExperiment:"true"===i.content.isEcsExperiment,placementId:e.placement,rewardsInfo:i.content.rewards,timeoutInMs:Number(t.timeoutInMs)}),n.push(r)}),t.set(i.content.rewards.activityId,n))}),t}}.getRewardsFromDataConnector();if(!e||0===e.size)return;const t=this.config.disableOffers;e.forEach((e,r)=>{if(!this.offerMap.has(r)){if(t&&t[r]&&t[r].disable)return;this.offerMap.set(r,e)}})}))}syncActivityTrackerMapWithIrisOffers(){this.activityTrackerMap.forEach((e,t)=>{this.offerMap.has(t)||this.activityTrackerMap.delete(t)})}getCoachmarkDataConnector(){return Object(d.a)(this,void 0,void 0,(function*(){const e=yield R.a.getInstance().rootReducer.getDataConnector(v.a.CoachmarkData);e?this.coachmarkDataConnector=e:A.a.sendAppErrorEvent(Object.assign(Object.assign({},w.oh.CoachmarkDataConnectorUndefined),{message:"Coachmark data connector is undefined"}))}))}getChromiumPageSettingsConnector(){return Object(d.a)(this,void 0,void 0,(function*(){const e=yield R.a.getInstance().rootReducer.getDataConnector(v.a.ChromiumPageSettings);this.chromiumPageSettingsConnector=e}))}renderOfferMessage(){var e;return Object(d.a)(this,void 0,void 0,(function*(){let t=!1;const r=null===(e=this.chromiumPageSettingsConnector)||void 0===e?void 0:e.getCurrentState();(null==r?void 0:r.currentLayout)===p.i.informational&&(t=!0);let i=this.config.offersPerSession;this.offerMap.forEach((e,r)=>Object(d.a)(this,void 0,void 0,(function*(){if((r!==s.TryInformationalMode||!t)&&this.offerPlacedOnUserScreen.has(r)&&!this.offerPlacedOnUserScreen.get(r)&&i>0){yield this.delay(this.config.delayLoadOfferInMs);const t=yield this.coachmarkDataConnector.addCoachmark([e[0]]);t&&(this.offerPlacedOnUserScreen.set(r,t),i--)}})))}))}delay(e){return Object(d.a)(this,void 0,void 0,(function*(){return new Promise(t=>window.setTimeout(t,e))}))}}var x=r("05Au");class D{reduce(e,t){if(!e)return{isRewardsUser:void 0,rewardPoints:void 0,unclaimedRewardPoints:void 0};if(!t)return e;let r,i=!1;return i=i||x.a.handleAction(t,n.setIsRewardsUser,t=>{r=Object.assign(Object.assign({},e),{isRewardsUser:t})}),i=i||x.a.handleAction(t,n.setRewardPoints,t=>{r=Object.assign(Object.assign({},e),{rewardPoints:t})}),i=i||x.a.handleAction(t,n.setUnclaimedRewardPoints,t=>{r=Object.assign(Object.assign({},e),{unclaimedRewardPoints:t})}),r||e}}var L=r("vIjt");const N={experienceConfigSchema:c.RewardsDataConfigSchema,mockConfig:L.mockConfig,defaultMockState:{},mockState:[{key:"preview",value:{}}]}},c9mP:function(e,t){},msIb:function(e,t,r){"use strict";r.d(t,"a",(function(){return i}));var i,n=r("D57K"),s=r("rvYQ"),a=r("y+Kz"),o=r("I6Lx"),c=r("wBSZ"),d=r("ax+D"),u=r("BQg2"),l=r("kN1G"),g=r("/+Un"),h=r("HDSB"),f=r("NIfb"),v=r("MptA");!function(e){function t(e=null,t,r=!0,n=null,c=!1,d=Object(l.j)()){const u=Object(s.b)(),g=[{key:a.s.apiKey,value:u.OneServiceApiKey},{key:a.s.activityId,value:u.ActivityId},{key:a.s.ocid,value:r?i(u.TrackInfo,t):t},{key:a.s.market,value:u.CurrentMarket}];e&&g.push({key:a.s.user,value:e});let h=Object(o.a)().CurrentFlights;if(n){h=h?`${h},${n}`:n;const e="prg-bngimg-t";-1===h.indexOf(e)&&(h+=","+e),!0===c&&(h=n)}return h&&g.push({key:a.s.fdhead,value:h}),d&&g.push({key:l.c,value:l.d}),o.b.IsBlendedEnterprise&&g.push({key:"audienceMode",value:"enterprise"}),g}function r(e=Object(l.j)(),t){return Object(n.a)(this,void 0,void 0,(function*(){const r={};if(e&&!(yield Object(l.g)())){const e=yield Object(l.e)(c.c,c.f,c.e);e&&e.token&&t?r[a.r.entAuthorization]=e.token:e&&e.token&&(r[a.r.authorization]="Bearer "+e.token)}if(!Object(h.a)()){const e=Object(f.a)().cookie;e&&(r.Cookie=e);const t=Object(f.a)().referer;t&&(r.Referer=t)}return r}))}function i(e,t){return d.a.isNonNullObject(e)&&d.a.isNonNullObject(e.sitePage)&&Object(v.a)(e.sitePage.page_product)&&Object(v.a)(e.sitePage.page_type)?e.sitePage.page_product+"-"+e.sitePage.page_type+(t?"-"+t:""):t}e.authenticationTicketType="10",e.signedInCookieNameHeader="signedInCookieName",e.userLocationHeader="user-location",e.serviceRequestOnComplete=function(e,t){return Object(n.a)(this,void 0,void 0,(function*(){try{const r=yield e();return t(),r}catch(e){throw t(),e}}))},e.getOneServiceParamsWithoutAuth=t,e.getOneServiceNonDynamicParamsWithoutAuth=function(e,t=!0){const r=Object(s.b)(),n=[{key:a.s.apiKey,value:r.OneServiceApiKey},{key:a.s.ocid,value:t?i(r.TrackInfo,e):e},{key:a.s.market,value:r.CurrentMarket}];return Object(l.j)()&&n.push({key:l.c,value:l.d}),n},e.getOneServiceParamsWithAuth=function(e=null,r,i=!0,n=null,o=!1){const c=Object(s.b)().AuthCookieName,d=[...t(e,r,i,n,o)];return c&&d.push({key:a.s.signInCookieName,value:c.toUpperCase()}),d},e.getOneServiceHeaders=r,e.getOneServiceFeedCallHeaders=function(e,t){return Object(n.a)(this,void 0,void 0,(function*(){const i=yield r(e,t),n=Object(s.b)(),o=n.ActivityId;return n.SendFeedCallActivityIdInHeader&&o&&(i[a.r.activityId]=o),i}))},e.getLocationParams=function(e,t){const r=Object(s.b)(),i=e||r.Latitude,n=t||r.Longitude;return i&&n?{key:a.s.location,value:`${i}|${n}`}:null},e.getOneServiceOCID=i,e.getBaseRequestData=function(t){return Object(n.a)(this,void 0,void 0,(function*(){return{headers:yield e.getOneServiceHeaders(),method:t}}))},e.getCommonParams=function(e,t=!1){return Object(o.a)().UserIsSignedIn?this.getOneServiceParamsWithAuth(Object(s.b)().UserId,e,t):this.getOneServiceParamsWithoutAuth(Object(s.b)().UserId,e,t)},e.getCommonParams2=function(e,t=!0,r=!1){return Object(g.e)()?this.getOneServiceParamsWithAuth(Object(s.b)().UserId,e,t,r):this.getOneServiceParamsWithoutAuth(Object(s.b)().UserId,e,t,r)},e.urlContainsOcidParam=function(e){if(!e)return!1;const t=e.split("?");if(t.length<2)return!1;const r=t[1].split("#")[0];return!!new u.a(r).get("ocid")},e.removeOcidFromUrl=function(e){if(!e)return e;const t=e.split("?");if(t.length<2)return e;const r=t[1].split("#")[0],i=new u.a(r);if(i.get("ocid")){i.delete("ocid");let t=e.replace(r,i.toString());return"?"===t.charAt(t.length-1)&&(t=t.substring(0,t.length-1)),t}return e},e.removeOcidFromRiverCardProviderResponse=function(t){t&&t.cardMetadata&&t.cardMetadata.length&&t.cardMetadata.forEach(t=>{t.cardContent&&t.cardContent.destinationUrl?t.cardContent.destinationUrl=e.removeOcidFromUrl(t.cardContent.destinationUrl):t.subItems&&t.subItems.length&&t.subItems.forEach(t=>{t.cardContent&&t.cardContent.destinationUrl&&(t.cardContent.destinationUrl=e.removeOcidFromUrl(t.cardContent.destinationUrl))})})},e.removeOcidFromWindowsOneServiceResponse=function(t){t&&t.cards&&t.cards.forEach(t=>{t.subCards.forEach(t=>{t.url?t.url=e.removeOcidFromUrl(t.url):t.subCards&&t.subCards.forEach(t=>{t.url&&(t.url=e.removeOcidFromUrl(t.url))})})})}}(i||(i={}))},vIjt:function(e,t){}}]);