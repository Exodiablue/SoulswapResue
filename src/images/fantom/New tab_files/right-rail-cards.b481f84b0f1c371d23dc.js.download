(window.webpackJsonp=window.webpackJsonp||[]).push([["right-rail-cards"],{Cj5D:function(t,e,i){"use strict";i.d(e,"a",(function(){return n})),i.d(e,"b",(function(){return l}));var a,n,o=i("C4R5"),s=i("HS3Q"),r=i("+qLX"),d=i("w0HK");function l(t,e){t&&e?Object(o.a)().pushHistory(s.a.Personalize,"",{isRequestFromSdCardAddRemoveClick:!0}):t&&Object(d.a)().switchPivot({pivotId:t.pivotId,configIndexHref:t.configIndexHref,configIndexRef:t.configIndexRef,context:Object.assign(Object.assign({},t.context),{isRequestFromSdCardAddRemoveClick:!0}),telemetryPageName:r.a.Interests,display:t.displayName})}!function(t){t.SwitchToPageSettings="SwitchToPageSettings",t.SwitchToNewsSettingsInPersonalizePivot="SwitchToNewsSettingsInPersonalizePivot"}(a||(a={})),function(t){t.edgePageSettings="EdgePageSettings",t.chromiumPageSettings="ChromiumPageSettings",t.proActiveCanvasSettingHandler="ProActiveCanvasHandler",t.localStorageSettings="LocalStorageSettings"}(n||(n={}))},PDpT:function(t,e){},jBRJ:function(t,e,i){"use strict";i.r(e),i.d(e,"ToolingInfo",(function(){return U})),i.d(e,"RightRailCards",(function(){return E})),i.d(e,"RightRailCardsTemplate",(function(){return W})),i.d(e,"RightRailCardsStyles",(function(){return Q}));var a=i("PDpT"),n=i("D57K"),o=i("cxul"),s=i("VFke"),r=i("HN5f"),d=i("ssy2"),l=i("Ac7j"),c=i("s9+9"),h=i("Zn5T"),g=i("K1Uj"),u=i("LJMo"),C=i("w0HK"),p=i("Z118"),y=i("u5KZ"),R=i("dTwT"),f=i("RIQ7"),m=i("rvYQ"),b=i("1aPi"),S=i("9RHM"),v=i("QHbP"),M=i("wZHk");i("Cj5D");const D={bingShoppingVisible:!0,moneyVisible:!0,sportsVisible:!0,weatherVisible:!0,horoscopeVisible:!0,onThisDayVisible:!0,electionsVisible:!0,esportsVisible:!0,lotteryVisible:!0,qnaVisible:!0,recipesVisible:!0,autosMarketplaceVisible:!0,healthCardVisible:!0};var w=i("ypwz"),O=i("HxRh"),A=i("qibw"),T=i("IqCT"),L=i("ejtM"),j=i("oePG"),P=i("+Ht2"),x=i("ac9z"),k=i("Z3LZ");class E extends T.a{constructor(){super(...arguments),this.rightRailSectionHasAds=!1,this.unRenderedRiverContent=[],this.rightRailCardsLayoutTemplate=[],this.rightRailCardMenuData={isMenuOpen:!1,rightRailActionMenu:null,styles:null},this.goToPersonalizeCallback=()=>{const{oneRiverInterestsPivotInfo:t,pivotsNavInstanceId:e}=this.config;Object(C.a)(e).switchPivot({pivotId:t.pivotId,configIndexHref:t.configIndexHref,configIndexRef:t.configIndexRef,context:{isRequestFromSdCardAddRemoveClick:!0},telemetryPageName:"Xfeed",display:t.displayName})},this.handleClick=t=>{this.rightRailCardMenuData.rightRailActionMenu&&this.rightRailCardMenuData.rightRailActionMenu.referrerButton&&!this.rightRailCardMenuData.rightRailActionMenu.referrerButton.contains(t.path[0])&&this.rightRailCardActionMenuContainer&&!this.rightRailCardActionMenuContainer.contains(t.path[0])&&this.closeSDCardActionsMenu()},this.handleKeyDown=t=>{this.rightRailCardMenuData.rightRailActionMenu&&this.rightRailCardMenuData.rightRailActionMenu.referrerButton&&!this.rightRailCardMenuData.rightRailActionMenu.referrerButton.contains(t.path[0])&&this.rightRailCardActionMenuContainer&&!this.rightRailCardActionMenuContainer.contains(t.path[0])&&this.closeSDCardActionsMenu()},this.clickSDCardActionButton=(t,e)=>Object(n.a)(this,void 0,void 0,(function*(){t.menuItems.forEach(t=>{"edit"===t.id?o.b.trafficCard:"hide"===t.id?e===o.b.moneyCard&&(t.onClick=this.hideMoneyCardAndRefresh):"more"===t.id?t.onClick=this.goToPersonalizeCallback:"dataProvider"===t.id?t.onClick=this.showMoneyCardDataProvider:"addWatchlist"===t.id&&(t.onClick=this.goToAddSymbolCallback)}),t.onDismiss=this.closeSDCardActionsMenu;const i=yield this.getPlacementStyle(t.referrerButton,document.dir,this.rightRailCardActionMenuContainer.offsetWidth,this.rightRailCardActionMenuContainer.offsetHeight);this.rightRailCardMenuData={isMenuOpen:!this.rightRailCardMenuData.isMenuOpen,rightRailActionMenu:t},this.updateMenuPositionStyle(i)})),this.mapSDCardDataToFeedLayout=t=>Object(n.a)(this,void 0,void 0,(function*(){yield this.fetchFeedContent(null,!0);const e=yield this.wpoCardProvider.wpoRightRailPromise.getResultAsync();e&&e.subSections&&e.subSections.length&&(this.wpoCardProvider.shouldResetRightRailPromise=!0,e.subSections.forEach((e,i)=>{const a=e.cards.find(e=>e.type===t);if(void 0!==a){const e=this.rightRailCardsLayoutData[i],n=e.cardMetadataList.findIndex(e=>e.type===t),o=e.cardMetadataList;o[n]=a;const r=Object.assign(Object.assign({},e),{feedData:this.mapFeedData(o,s.a[this.rightRailCardsLayoutTemplate[i]],!0,this.telemetryObject),templateId:this.rightRailCardsLayoutTemplate[i],cardMetadataList:o});this.rightRailCardsLayoutData=[...this.rightRailCardsLayoutData.slice(0,i),r,...this.rightRailCardsLayoutData.slice(i+1)]}}))})),this.closeSDCardActionsMenu=()=>{this.rightRailCardMenuData={isMenuOpen:!1,rightRailActionMenu:this.rightRailCardMenuData.rightRailActionMenu}},this.showMoneyCardDataProvider=()=>{window.open(this.config.moneyCardConfig.financeDataProviderPage,"_blank"),this.rightRailCardMenuData={isMenuOpen:!1,rightRailActionMenu:this.rightRailCardMenuData.rightRailActionMenu}},this.hideMoneyCardAndRefresh=()=>Object(n.a)(this,void 0,void 0,(function*(){const t=yield this.financeUserService.enableDisableMoneyCard(!1);if(this.rightRailCardMenuData={isMenuOpen:!1,rightRailActionMenu:this.rightRailCardMenuData.rightRailActionMenu},t&&(yield Object(x.d)(),yield this.fetchFeedContent(null,!0),yield this.getRightRailData()),this.pageSettingsDataConnector){const{sdCardSettings:t}=this.pageSettingsDataConnector.getCurrentState();t.moneyVisible=!1,l.a.updateLocalStorage.getActionSender(this.pageSettingsDataConnector).send(t)}else if(Object(R.a)().supported){const t=Object(R.a)().getObject("localCardState",D);t.moneyVisible=!1,Object(R.a)().setObject("localCardState",t)}return t})),this.setMoneyCardData=t=>{this.mapSDCardDataToFeedLayout(u.a.StockQuote)},this.goToAddSymbolCallback=()=>{if(this.config.moneyCardConfig.disableInLineAddWatchlist){const t=Object(f.b)(),e=new URL(this.config.moneyCardConfig.financeWatchlistPage);t&&e.searchParams.append("ocid",t),window.open(e.href,"_blank")}else this.setMoneyCardData({cardType:g.c.AddWatchlist,lastCardType:this.moneyCardData.cardType,optionSwitch:!1,showSuggestions:!1,noSuggestion:!1,searchSuggestions:[]});this.rightRailCardMenuData={isMenuOpen:!1,rightRailActionMenu:this.rightRailCardMenuData.rightRailActionMenu}},this.onMoneyCardAddSymbolClick=()=>{this.moneyCardData.setMoneyCardData({cardType:g.c.AddWatchlist,lastCardType:this.moneyCardData.cardType,optionSwitch:!1,showSuggestions:!1,noSuggestion:!1,searchSuggestions:[]})},this.onMoneyCardActionInputText=t=>{const e=t.detail;this.moneyCardData.handleQuoteSearch(e)},this.onMoneyCardTitleClick=()=>{this.moneyCardData.cardType===g.c.AddWatchlist&&this.moneyCardData.setMoneyCardData({cardType:this.moneyCardData.lastCardType,lastCardType:this.moneyCardData.cardType,showSuggestions:!1,noSuggestion:!1,searchSuggestions:[]})},this.addToWatchlist=t=>{t.detail},this.handleQuoteSearch=Object(b.a)(t=>Object(n.a)(this,void 0,void 0,(function*(){const e=t.trim();if(""!==e)try{const t=yield this.autoSuggestServiceConnect.getAutoSuggest(e,4);return void(t&&0!==t.length?this.setMoneyCardData({cardType:g.c.AddWatchlist,searchSuggestions:t,showSuggestions:!0,noSuggestion:!1}):this.setMoneyCardData({cardType:g.c.AddWatchlist,showSuggestions:!1,noSuggestion:!0}))}catch(t){this.setMoneyCardData({cardType:g.c.AddWatchlist,showSuggestions:!1,noSuggestion:!0})}else this.setMoneyCardData({cardType:g.c.AddWatchlist,showSuggestions:!1,noSuggestion:!1})})),200),this.refreshFeed=()=>Object(n.a)(this,void 0,void 0,(function*(){this.rightRailCardMenuData={isMenuOpen:!1,rightRailActionMenu:this.rightRailCardMenuData.rightRailActionMenu},yield Object(x.d)(),yield this.fetchFeedContent(null,!0),yield this.getRightRailData()}))}experienceConnected(){this.pageSettingsDataConnector=Object(P.c)(c.a.ChromiumPageSettings),this.financeUserService=d.FinanceServices.getFinanceUserService(),this.autoSuggestServiceConnect=d.FinanceServices.getAutoSuggestService(),this.getRightRailData(),document.addEventListener("action-add-symbol",this.onMoneyCardAddSymbolClick),document.addEventListener("action-text-input",this.onMoneyCardActionInputText),document.addEventListener("action-title-clicked",this.onMoneyCardTitleClick),document.addEventListener("action-add-to-watchlist",this.addToWatchlist),document.addEventListener("mousedown",this.handleClick),document.addEventListener("keydown",this.handleKeyDown)}getExperienceType(){return h.a.rightRailCards}shadowDomPopulated(){Object(v.b)(M.a.rightRailSectionKey,this.shadowRoot.getElementById("rightRailCardsSection")),this.rightRailSection=Object(v.a)(M.a.rightRailSectionKey),this.mutationObs=new MutationObserver((t=>{this.indexOfLastLayoutElement=this.rightRailSection.children.length>=2?this.rightRailSection.children.length-2:0,this.lastRightRailCardElement=this.rightRailSection.children[this.indexOfLastLayoutElement].shadowRoot.lastElementChild;const e=this.lastRightRailCardElement.getBoundingClientRect().top;this.scrollToBeSticky=e+document.documentElement.scrollTop-160}).bind(this)),document.addEventListener("scroll",this.toggleSticky.bind(this));const t=this.rightRailSection;t&&this.mutationObs.observe(t,{childList:!0,subtree:!0,attributes:!0})}getRightRailData(){return Object(n.a)(this,void 0,void 0,(function*(){const t=yield this.wpoCardProvider.wpoRightRailPromise.getResultAsync();if(!t)return;this.wpoCardProvider.shouldResetRightRailPromise=!0;const{subSections:e}=t;e&&0!==e.length&&(this.unRenderedRiverContent=[],this.rightRailCardsLayoutTemplate=[],e.forEach(t=>{this.unRenderedRiverContent=this.unRenderedRiverContent.concat(t.cards),this.rightRailCardsLayoutTemplate.push(t.layoutTemplate)}),0===this.rightRailCardsLayoutTemplate.length&&this.rightRailCardsLayoutTemplate.push("wpo-right-rail"),this.mapRightRailResponseTemplate())}))}getOverrideLayoutStyle(t){const e={};if(t.reverseLayoutGap)return;const i=t.layoutGap;if(void 0!==i&&(e.gap=i+"px",t.fixedCardHeight)){const t=((304-i)/2).toFixed(1);e["grid-auto-rows"]=t+"px"}return Object.keys(e).map(t=>`${t}: ${e[t]}`).join(";")}mapRightRailResponseTemplate(){let t=[];const e=[];this.rightRailCardsLayoutTemplate.forEach(t=>{e.push(this.getCardMetaDataForRightRailSection(s.a[t]))}),e.forEach((e,i)=>{const a=this.rightRailCardsLayoutTemplate[i];t.push({feedData:this.mapFeedData(e,s.a[a],!0,this.telemetryObject),overrideLayoutStyle:this.getOverrideLayoutStyle(this.config),templateId:a,cardMetadataList:e})}),this.rightRailCardsLayoutData=t,Object(k.j)().then(()=>{t=[],e.forEach((e,i)=>{const a=this.rightRailCardsLayoutTemplate[i];t.push({feedData:this.mapFeedData(e,s.a[a],!0,this.telemetryObject),overrideLayoutStyle:this.getOverrideLayoutStyle(this.config),templateId:a,cardMetadataList:e})}),this.rightRailCardsLayoutData=t,this.rightRailSectionHasAds&&this.fetchAdContent()})}getCardMetaDataForRightRailSection(t){const e=[];if(!t)return e;const i=t.cardCount;for(let t=0;t<i;t++){const t=this.unRenderedRiverContent.shift();t.type===u.a.NativeAd&&(this.rightRailSectionHasAds=!0),e.push(t)}return e}mapFeedData(t,e,i,a){if(!t.length)return null;const n={cards:[],C5:[],C4:[],C3:[],C2:[],C1:[]},{cardSlots:s}=e;return t.forEach((t,e)=>{var d;let l=r.a[t.type];if(!l)return;const c={cardMetadata:t,parentTelemetryObject:a,cardSlot:s[e],openLinksInNewTab:i,isAnaheimDesign:m.a.AppType===w.a.EdgeChromium,goToPersonalizeCallback:this.goToPersonalizeCallback,goToPersonalizeSettingsCallback:this.goToPersonalizeCallback,hideCardCallback:()=>this.refreshFeed(),localizedStrings:this.config.localizedStrings,configOptions:Object(S.a)(this.config),sdCardActionClickHandler:this.clickSDCardActionButton,refreshSDCardSection:()=>this.refreshFeed()};l===o.b.moneyCard&&(c.cardStateData=this.moneyCardData,c.cardLayout=g.b.full),l===o.b.serendipityCard&&(l=o.b.trendingNowCard),l!==o.b.nativeAdCard||c.cardMetadata.placement||(c.cardMetadata={type:u.a.NativeAd,placement:{items:[]}}),null===(d=L.a[l])||void 0===d||d.call(L.a,c,t,this,e);const h=o.a[l].getFeedDataForCard(c);Object.keys(h).forEach(t=>{n[t]=n[t].concat(h[t])})}),n}fetchAdContent(){return Object(n.a)(this,void 0,void 0,(function*(){const t=yield this.getRightRailAdsData();if(!t)return;const e=[];this.rightRailCardsLayoutData.forEach((i,a)=>{const n=i.cardMetadataList.findIndex(t=>t.type===u.a.NativeAd);if(-1!==n&&0!==t.length){const o=Object(S.a)(i.cardMetadataList);o.splice(n,1,t.shift()),e.push({feedData:this.mapFeedData(o,s.a[this.rightRailCardsLayoutTemplate[a]],!0,this.telemetryObject),overrideLayoutStyle:this.getOverrideLayoutStyle(this.config),templateId:this.rightRailCardsLayoutTemplate[a],cardMetadataList:o})}else e.push(i)}),this.rightRailCardsLayoutData=e}))}fetchFeedContent(t,e){return Object(n.a)(this,void 0,void 0,(function*(){try{yield this.wpoCardProvider.fetch(t,p.b.refresh)}catch(t){y.a.sendAppErrorEvent(Object.assign(Object.assign({},O.Db),{message:"Content fetch failed for Desktop Feed SingleColumn.",pb:Object.assign(Object.assign({},O.Db.pb),{customMessage:"Failed with exception : "+t})}))}}))}updateMenuPositionStyle(t){let e="";for(const i in t)e+=`${i}: ${t[i]}px;`;this.rightRailCardActionMenuContainer.setAttribute("style",e)}getPlacementStyle(t,e,i,a){return Object(n.a)(this,void 0,void 0,(function*(){let n,o,s,r;if(t){const e=yield this.determinePosition(t,this.rightRailCardActionMenuContainer.parentElement);n=e.left,o=e.top+e.offset+document.body.scrollTop,s=e.offset,r=e.rootOffsetLeft}if(!i)return{top:o,left:window.scrollX};const d=window.innerWidth,l=window.document&&window.document.documentElement&&window.document.documentElement.clientHeight+window.scrollY,c=window.document&&window.document.documentElement&&window.document.documentElement.offsetHeight,h=Math.min(l,c)+document.body.scrollTop;if(h&&o+a>h){if(o-a-s<0)return this.getHorizontallyPlacedStyle(e,n,o,s,d,h,i,a,r);o=o-a-s}const g={top:o,left:n-i+s},u={top:o,left:n};return this.getPrioritizedFittingPosition(e,[g,u],i,d,s,r)}))}getPrioritizedFittingPosition(t,e,i,a,n,o){const[s,r]=t===A.a.rtl?e:[e[1],e[0]],d=o+s.left+i<a&&o+s.left>0,l=o+r.left+i<a;if(d)return s;if(!d&&l)return r;{const i={top:e[0].top};return t===A.a.rtl?i.right=.5*n:i.left=.5*n,i}}getHorizontallyPlacedStyle(t,e,i,a,n,o,s,r,d){i-a+r<=o?i-=a:i-r>=0?i-=r:i=i-.5*a<.5*o?.5*a:o-.5*a-r;const l={top:i,left:e+a},c={top:i,left:e-s};return this.getPrioritizedFittingPosition(t,[c,l],s,n,a,d)}determinePosition(t,e){return Object(n.a)(this,void 0,void 0,(function*(){return new Promise((function(i){setTimeout((function(){const a=Object(v.a)(M.a.singleColumnFeedRoot),n=e.getBoundingClientRect().top,o=a.getBoundingClientRect().left;if(t){const{top:e,left:a,width:s}=t.getBoundingClientRect();i({top:e-n,left:a-o+window.scrollX,offset:s,rootOffsetLeft:o})}else i({top:window.scrollY,left:window.scrollX,offset:0})}),0)}))}))}toggleSticky(){if(!this.lastRightRailCardElement&&(this.lastRightRailCardElement=this.rightRailSection&&this.rightRailSection.children&&this.rightRailSection.children.length>this.indexOfLastLayoutElement&&this.rightRailSection.children[this.indexOfLastLayoutElement].shadowRoot&&this.rightRailSection.children[this.indexOfLastLayoutElement].shadowRoot.lastElementChild,!this.lastRightRailCardElement))return;const t=Math.max(document.documentElement.scrollTop,document.body.scrollTop),e=this.scrollToBeSticky>=0&&t>this.scrollToBeSticky,i={width:"300px",height:e?this.lastRightRailCardElement.offsetHeight+"px":"100%",position:"fixed",top:"160px"};e?this.isSticky||(Object.assign(this.lastRightRailCardElement.style,i),this.isSticky=!0):this.isSticky&&(Object.assign(this.lastRightRailCardElement.style,{position:"initial"}),this.isSticky=!1)}}Object(n.d)([j.d],E.prototype,"getRightRailAdsData",void 0),Object(n.d)([j.d],E.prototype,"moneyCardData",void 0),Object(n.d)([j.d],E.prototype,"rightRailCardsLayoutTemplate",void 0),Object(n.d)([j.d],E.prototype,"rightRailCardsLayoutData",void 0),Object(n.d)([j.d],E.prototype,"rightRailCardMenuData",void 0);var I=i("Nt9a"),F=i("6BDD"),H=i("UNqU"),z=i("+53S"),$=i("6vBc");const B=F.b`
 <msft-feed-layout
    key=${(t,e)=>"rightRail-"+e.index}
    style=${t=>t.overrideLayoutStyle}
    :data=${t=>t.feedData}
    :cardTemplateMap= ${t=>I.a}
    :layoutStyles=${(t,e)=>s.a[t.templateId].styles}
  >
 </msft-feed-layout>
`,V=F.b`
<fluent-menu-item
    key=${(t,e)=>"ccaitem-"+e.index}
    id=${(t,e)=>t.id} tabIndex={0} 
    class="menuItem"
    @click=${t=>t.onClick()}>
    <span aria-label=${t=>t.title}>
        ${t=>t.title}
    </span>
</fluent-menu-item>
`,N=F.b`
<fluent-menu>
    ${Object(H.c)(t=>t.rightRailCardMenuData.rightRailActionMenu.menuItems,V)}
</fluent-menu>`,W=F.b`
    <div class="root"
    id="rightRailCardsSection">
        ${Object(H.c)(t=>t.rightRailCardsLayoutData,B)}
        <div class="menuContainer"
            ${Object(z.b)("rightRailCardActionMenuContainer")}>
            ${Object($.a)(t=>t.rightRailCardMenuData.isMenuOpen,N)}
        </div>
    </div>
`;var K=i("4X57"),q=i("8hiW");const Q=K.a`
    :host {
        width: 100%;
    }

    .root {
        border-radius: 6px;
        display: grid;
        gap: 12px;
    }

    .title {
        height: 48px;
        border-bottom: 1px solid ${q.Fb};
    }

    .menuContainer {
        box-shadow: 0 2.4px 7.2px rgb(0 0 0 / 18%), 0 12.8px 28.8px rgb(0 0 0 / 22%);
        display: inline;
        position: absolute;
        z-index: 100;
        max-width: 275px;
        min-width: 240px;
        overflow: hidden;
    }
`,U={experienceConfigSchema:a.RightRailCardsConfigSchema}}}]);